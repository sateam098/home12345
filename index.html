<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>ESP32 Controller</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      padding: 20px;
      backdrop-filter: blur(10px);
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: clamp(24px, 5vw, 36px);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      transition: transform 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-2px);
    }
    
    h2 {
      color: #3498db;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: clamp(18px, 4vw, 24px);
    }
    
    .device-status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .status-item {
      text-align: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .status-item:hover {
      background: #e9ecef;
      transform: scale(1.02);
    }
    
    .status-indicator {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin: 0 auto 10px;
      background-color: #e74c3c;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .status-indicator::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 60%;
      height: 60%;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    
    .status-on {
      background-color: #2ecc71;
      box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
    }
    
    .button-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
    }
    
    .button {
      padding: 15px 20px;
      font-size: clamp(14px, 3vw, 18px);
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .button:hover::before {
      left: 100%;
    }
    
    .button-on {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
      box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
    }
    
    .button-off {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
    }
    
    .button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    .button:active {
      transform: translateY(-1px);
    }
    
    .slider-container {
      margin: 30px 0;
      padding: 0 10px;
    }
    
    .slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: linear-gradient(to right, #3498db 0%, #9b59b6 100%);
      border-radius: 5px;
      outline: none;
      margin: 20px 0;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3498db, #2980b9);
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
      transition: all 0.3s ease;
    }
    
    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
    }
    
    .slider::-moz-range-thumb {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3498db, #2980b9);
      cursor: pointer;
      border: none;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
    }
    
    .angle-display {
      text-align: center;
      font-size: clamp(20px, 5vw, 32px);
      font-weight: bold;
      margin: 15px 0;
      color: #2980b9;
      background: linear-gradient(135deg, #3498db, #9b59b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .status-bar {
      background: linear-gradient(135deg, #34495e, #2c3e50);
      color: white;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
      font-size: clamp(12px, 2.5vw, 16px);
    }
    
    .connection-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    
    .info-item {
      background: rgba(255,255,255,0.1);
      padding: 10px;
      border-radius: 8px;
      backdrop-filter: blur(5px);
    }
    
    /* Loading animation */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      body {
        padding: 5px;
      }
      
      .container {
        padding: 15px;
        border-radius: 15px;
      }
      
      .card {
        padding: 15px;
        margin-bottom: 15px;
      }
      
      .button {
        padding: 12px 15px;
        font-size: 16px;
      }
      
      .device-status {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      
      .status-indicator {
        width: 25px;
        height: 25px;
      }
    }
    
    @media (max-width: 480px) {
      .button-container {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .device-status {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
    
    /* Desktop optimizations */
    @media (min-width: 1024px) {
      .container {
        padding: 40px;
      }
      
      .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      
      .device-status {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      .card {
        background: #2c3e50;
        color: #ecf0f1;
      }
      
      .status-item {
        background: #34495e;
        color: #ecf0f1;
      }
      
      .status-item:hover {
        background: #3c4e60;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè† ESP32 Smart Controller</h1>
    
    <div class="card">
      <h2>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
      <div class="device-status">
        <div class="status-item">
          <div class="status-indicator" id="fan-status"></div>
          <div><strong>üåÄ ‡∏û‡∏±‡∏î‡∏•‡∏° (IN1)</strong></div>
          <div id="fan-text">‡∏õ‡∏¥‡∏î</div>
        </div>
        <div class="status-item">
          <div class="status-indicator" id="light-status"></div>
          <div><strong>üí° ‡πÑ‡∏ü (IN2)</strong></div>
          <div id="light-text">‡∏õ‡∏¥‡∏î</div>
        </div>
      </div>
    </div>
    
    <div class="main-grid">
      <div>
        <div class="card">
          <h2>üåÄ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏û‡∏±‡∏î‡∏•‡∏°</h2>
          <div class="button-container">
            <button class="button button-on" onclick="controlDevice('fan', 'on')" id="fan-on-btn">
              ‚ö° ‡πÄ‡∏õ‡∏¥‡∏î‡∏û‡∏±‡∏î‡∏•‡∏°
            </button>
            <button class="button button-off" onclick="controlDevice('fan', 'off')" id="fan-off-btn">
              ‚èπÔ∏è ‡∏õ‡∏¥‡∏î‡∏û‡∏±‡∏î‡∏•‡∏°
            </button>
          </div>
        </div>
        
        <div class="card">
          <h2>üí° ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏ü</h2>
          <div class="button-container">
            <button class="button button-on" onclick="controlDevice('light', 'on')" id="light-on-btn">
              üîÜ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü
            </button>
            <button class="button button-off" onclick="controlDevice('light', 'off')" id="light-off-btn">
              üîÖ ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü
            </button>
          </div>
        </div>
      </div>
      
      <div>
        <div class="card">
          <h2>üîÑ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏ß</h2>
          <div class="slider-container">
            <input type="range" min="0" max="180" value="90" class="slider" id="servoSlider">
            <div class="angle-display">üìê ‡∏°‡∏∏‡∏°: <span id="servoValue">90</span>¬∞</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
      <div style="margin-bottom: 15px;">
        <label for="ip-input" style="display: block; margin-bottom: 5px; font-weight: bold;">üìç IP Address ‡∏Ç‡∏≠‡∏á ESP32:</label>
        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
          <input type="text" id="ip-input" placeholder="‡πÉ‡∏™‡πà IP Address (‡πÄ‡∏ä‡πà‡∏ô 192.168.1.100)" 
                 style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
          <button onclick="setIPAddress()" class="button button-on" style="min-width: 80px; padding: 10px 15px;">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
          </button>
        </div>
        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
          <button onclick="testConnection()" class="button" style="background: #f39c12; color: white; min-width: 120px; padding: 8px 12px; font-size: 14px;">
            üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
          </button>
          <button onclick="openESP32Page()" class="button" style="background: #9b59b6; color: white; min-width: 120px; padding: 8px 12px; font-size: 14px;">
            üåê ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ ESP32
          </button>
        </div>
      </div>
      <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
        üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ IP Address:</strong><br>
        ‚Ä¢ Serial Monitor ‡∏Ç‡∏≠‡∏á Arduino IDE<br>
        ‚Ä¢ Router Admin Panel (192.168.1.1)<br>
        ‚Ä¢ ‡πÅ‡∏≠‡∏õ‡∏Ñ‡πà‡∏≤‡∏¢ WiFi Scanner
      </div>
      <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-top: 15px;">
        <div style="font-weight: bold; color: #856404; margin-bottom: 10px;">‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS:</div>
        <div style="font-size: 13px; color: #856404; line-height: 1.4;">
          ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ô ESP32:<br>
          <code style="background: #f8f9fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">
            server.sendHeader("Access-Control-Allow-Origin", "*");
          </code>
        </div>
      </div>
    </div>
    
    <div class="status-bar">
      <div><strong>üåê ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</strong></div>
      <div class="connection-info">
        <div class="info-item">
          üìç IP Address: <span id="ip-address">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        </div>
        <div class="info-item">
          üîó ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="connection-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
        </div>
        <div class="info-item">
          ‚è∞ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="last-update">-</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    let fanStatus = false;
    let lightStatus = false;
    let isLoading = false;
    let currentIP = '';
    
    // ‡πÇ‡∏´‡∏•‡∏î IP address ‡∏à‡∏≤‡∏Å localStorage (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    function loadSavedIP() {
      const savedIP = localStorage.getItem('esp32_ip');
      if (savedIP) {
        currentIP = savedIP;
        document.getElementById('ip-input').value = savedIP;
        document.getElementById('ip-address').textContent = savedIP;
        return savedIP;
      } else {
        // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ hostname ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const hostname = window.location.hostname;
        if (hostname && hostname !== 'localhost' && hostname !== '127.0.0.1' && !hostname.includes('github')) {
          currentIP = hostname;
          document.getElementById('ip-input').value = hostname;
          document.getElementById('ip-address').textContent = hostname;
          return hostname;
        }
      }
      return null;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    async function testConnection() {
      if (!currentIP) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà IP Address ‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      
      const testBtn = event.target;
      testBtn.disabled = true;
      testBtn.textContent = 'üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
      
      try {
        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ
        const results = await Promise.allSettled([
          testHTTP(),
          testPing(),
          testBasicFetch()
        ]);
        
        let successCount = 0;
        let errorMessages = [];
        
        results.forEach((result, index) => {
          if (result.status === 'fulfilled') {
            successCount++;
          } else {
            errorMessages.push(result.reason);
          }
        });
        
        if (successCount > 0) {
          updateConnectionStatus('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ');
          alert('‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß');
          checkServerStatus(); // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á
        } else {
          throw new Error(errorMessages[0] || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ');
        }
        
      } catch (error) {
        console.error('Connection test failed:', error);
        let errorMsg = '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‚ùå\n\n';
        
        if (error.message.includes('CORS')) {
          errorMsg += '‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ô ESP32:\nserver.sendHeader("Access-Control-Allow-Origin", "*");';
        } else if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
          errorMsg += '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ:\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IP Address\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ ESP32 ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö WiFi Network ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô';
        } else {
          errorMsg += error.message;
        }
        
        alert(errorMsg);
        updateConnectionStatus('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‚ùå');
      } finally {
        testBtn.disabled = false;
        testBtn.textContent = 'üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö HTTP
    async function testHTTP() {
      const url = getAPIUrl('/');
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 5000);
      
      try {
        const response = await fetch(url, {
          method: 'GET',
          signal: controller.signal,
          mode: 'no-cors' // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î no-cors ‡∏Å‡πà‡∏≠‡∏ô
        });
        clearTimeout(timeoutId);
        return true;
      } catch (error) {
        clearTimeout(timeoutId);
        // ‡∏ñ‡πâ‡∏≤ no-cors ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á cors
        const response2 = await fetch(url, {
          method: 'GET',
          mode: 'cors'
        });
        return true;
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö Ping (‡πÉ‡∏ä‡πâ Image loading)
    async function testPing() {
      return new Promise((resolve, reject) => {
        const img = new Image();
        const timeout = setTimeout(() => {
          reject(new Error('Ping timeout'));
        }, 3000);
        
        img.onload = () => {
          clearTimeout(timeout);
          resolve(true);
        };
        
        img.onerror = () => {
          clearTimeout(timeout);
          // ‡πÅ‡∏°‡πâ error ‡∏Å‡πá‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏î‡πâ response)
          resolve(true);
        };
        
        img.src = getAPIUrl('/favicon.ico') + '?t=' + Date.now();
      });
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö Basic Fetch
    async function testBasicFetch() {
      const url = getAPIUrl('/status');
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 4000);
      
      const response = await fetch(url, {
        method: 'GET',
        signal: controller.signal,
        headers: {
          'Cache-Control': 'no-cache'
        },
        mode: 'cors'
      });
      
      clearTimeout(timeoutId);
      return response.ok;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ ESP32 ‡πÉ‡∏ô tab ‡πÉ‡∏´‡∏°‡πà
    function openESP32Page() {
      if (!currentIP) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà IP Address ‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      
      let url = currentIP;
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'http://' + url;
      }
      
      window.open(url, '_blank');
    }
    function setIPAddress() {
      const ipInput = document.getElementById('ip-input');
      const newIP = ipInput.value.trim();
      
      if (!newIP) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà IP Address');
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö IP (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢)
      const ipPattern = /^(\d{1,3}\.){3}\d{1,3}$/;
      if (!ipPattern.test(newIP)) {
        alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö IP Address ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 192.168.1.100');
        return;
      }
      
      currentIP = newIP;
      localStorage.setItem('esp32_ip', newIP);
      document.getElementById('ip-address').textContent = newIP;
      
      // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      updateConnectionStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
      checkServerStatus();
      
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å IP Address ‡πÅ‡∏•‡πâ‡∏ß: ' + newIP);
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    function getAPIUrl(endpoint) {
      if (!currentIP) {
        console.error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address');
        return null;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ http:// ‡∏´‡∏£‡∏∑‡∏≠ https:// ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      let baseUrl = currentIP;
      if (!baseUrl.startsWith('http://') && !baseUrl.startsWith('https://')) {
        baseUrl = 'http://' + baseUrl;
      }
      
      return baseUrl + endpoint;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
    function setLoading(loading) {
      isLoading = loading;
      const buttons = document.querySelectorAll('.button');
      const slider = document.getElementById('servoSlider');
      
      buttons.forEach(btn => {
        if (!btn.onclick || btn.onclick.toString().includes('setIPAddress')) return;
        btn.classList.toggle('loading', loading);
        btn.disabled = loading;
      });
      
      slider.disabled = loading;
      
      if (loading) {
        document.getElementById('connection-status').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á...';
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà)
    async function controlDevice(device, action) {
      if (isLoading) return;
      
      if (!currentIP) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        return;
      }
      
      setLoading(true);
      
      try {
        const url = getAPIUrl(`/${device}/${action}`);
        if (!url) {
          throw new Error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address');
        }
        
        // ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
        let response;
        let success = false;
        
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: CORS ‡∏õ‡∏Å‡∏ï‡∏¥
        try {
          response = await fetch(url, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
            mode: 'cors',
            cache: 'no-cache'
          });
          
          if (response.ok || response.status === 200) {
            success = true;
          }
        } catch (corsError) {
          console.log('CORS method failed, trying no-cors...');
        }
        
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: No-CORS (‡∏ñ‡πâ‡∏≤ CORS ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
        if (!success) {
          try {
            response = await fetch(url, {
              method: 'GET',
              mode: 'no-cors',
              cache: 'no-cache'
            });
            // no-cors ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô response ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà error ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ
            success = true;
          } catch (noCorsError) {
            console.log('No-CORS method failed, trying JSONP...');
          }
        }
        
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡πÉ‡∏ä‡πâ Image request (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GET requests)
        if (!success) {
          try {
            await new Promise((resolve, reject) => {
              const img = new Image();
              const timeout = setTimeout(() => {
                reject(new Error('Image request timeout'));
              }, 5000);
              
              img.onload = img.onerror = () => {
                clearTimeout(timeout);
                resolve(true);
              };
              
              img.src = url + '?t=' + Date.now();
            });
            success = true;
          } catch (imgError) {
            console.log('Image method failed');
          }
        }
        
        if (success) {
          updateDeviceStatus(device, action === 'on');
          updateConnectionStatus('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ');
          console.log(`${device} ${action} successful`);
          
          // ‡πÄ‡∏û‡∏¥‡πà‡∏° haptic feedback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
          if (navigator.vibrate) {
            navigator.vibrate(50);
          }
          
          // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
          setTimeout(() => {
            checkServerStatus();
          }, 1000);
          
        } else {
          throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ');
        }
        
      } catch (error) {
        console.error('Control Error:', error);
        let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ùå';
        
        if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
          errorMsg = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ üîå\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IP Address\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö WiFi Network\n‚Ä¢ ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠"';
        } else if (error.message.includes('CORS')) {
          errorMsg = '‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS üîß\n‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô ESP32:\nserver.sendHeader("Access-Control-Allow-Origin", "*");';
        }
        
        updateConnectionStatus(errorMsg.split('\n')[0]);
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° haptic feedback ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
        if (navigator.vibrate) {
          navigator.vibrate([100, 50, 100]);
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á alert ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
        if (!error.message.includes('AbortError')) {
          setTimeout(() => alert(errorMsg), 100);
        }
        
      } finally {
        setLoading(false);
      }
    }
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    function updateDeviceStatus(device, status) {
      const statusElement = document.getElementById(`${device}-status`);
      const textElement = document.getElementById(`${device}-text`);
      
      if (device === 'fan') {
        fanStatus = status;
        if (textElement) textElement.textContent = status ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
      }
      if (device === 'light') {
        lightStatus = status;
        if (textElement) textElement.textContent = status ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
      }
      
      statusElement.className = status ? 'status-indicator status-on pulse' : 'status-indicator';
      
      // ‡∏´‡∏¢‡∏∏‡∏î animation ‡∏´‡∏•‡∏±‡∏á 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      setTimeout(() => {
        statusElement.classList.remove('pulse');
      }, 2000);
    }
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    function updateConnectionStatus(status) {
      document.getElementById('connection-status').textContent = status;
      document.getElementById('last-update').textContent = new Date().toLocaleTimeString('th-TH');
    }
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏ß
    const slider = document.getElementById('servoSlider');
    const valueDisplay = document.getElementById('servoValue');
    let servoTimeout;
    
    slider.addEventListener('input', function() {
      const angle = this.value;
      valueDisplay.textContent = angle;
      
      if (!currentIP) {
        console.warn('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address');
        return;
      }
      
      // ‡πÉ‡∏ä‡πâ debounce ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
      clearTimeout(servoTimeout);
      servoTimeout = setTimeout(async () => {
        try {
          const url = getAPIUrl(`/servo?angle=${angle}`);
          if (!url) return;
          
          // ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö controlDevice
          let success = false;
          
          try {
            const response = await fetch(url, { mode: 'cors' });
            if (response.ok) success = true;
          } catch (error) {
            // ‡∏•‡∏≠‡∏á no-cors
            try {
              await fetch(url, { mode: 'no-cors' });
              success = true;
            } catch (error2) {
              // ‡∏•‡∏≠‡∏á image method
              const img = new Image();
              img.src = url + '&t=' + Date.now();
              success = true; // ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ
            }
          }
          
          if (success) {
            updateConnectionStatus('‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏ß ‚úÖ');
          } else {
            throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏ß‡πÑ‡∏î‡πâ');
          }
          
        } catch (error) {
          console.error('Servo Error:', error);
          updateConnectionStatus('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏ß ‚ùå');
        }
      }, 200);
    });
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
    async function checkServerStatus() {
      if (!currentIP) {
        updateConnectionStatus('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address ‚öôÔ∏è');
        return false;
      }
      
      try {
        const url = getAPIUrl('/status');
        if (!url) return false;
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 8000); // timeout 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        const response = await fetch(url, { 
          signal: controller.signal,
          headers: {
            'Cache-Control': 'no-cache'
          },
          mode: 'cors'
        });
        
        clearTimeout(timeoutId);
        
        if (response.ok) {
          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
            const data = await response.json();
            updateDeviceStatus('fan', data.fan);
            updateDeviceStatus('light', data.light);
            slider.value = data.servo || 90;
            valueDisplay.textContent = data.servo || 90;
          }
          updateConnectionStatus('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
          return true;
        } else {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
      } catch (error) {
        console.error('Status check error:', error);
        let errorMsg = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‚ùå';
        
        if (error.name === 'AbortError') {
          errorMsg = 'Timeout - ESP32 ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á ‚è∞';
        } else if (error.message.includes('Failed to fetch')) {
          errorMsg = '‡πÑ‡∏°‡πà‡∏û‡∏ö ESP32 üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IP Address';
        }
        
        updateConnectionStatus(errorMsg);
        return false;
      }
    }
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    window.addEventListener('load', async function() {
      updateConnectionStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
      
      // ‡πÇ‡∏´‡∏•‡∏î IP address ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
      const savedIP = loadSavedIP();
      
      if (savedIP) {
        // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        const connected = await checkServerStatus();
        
        if (!connected) {
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
          updateDeviceStatus('fan', false);
          updateDeviceStatus('light', false);
          slider.value = 90;
          valueDisplay.textContent = 90;
        }
      } else {
        updateConnectionStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address ‚öôÔ∏è');
        updateDeviceStatus('fan', false);
        updateDeviceStatus('light', false);
        slider.value = 90;
        valueDisplay.textContent = 90;
      }
    });
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ IP address)
    setInterval(() => {
      if (currentIP) {
        checkServerStatus();
      }
    }, 30000);
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå/‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå
    window.addEventListener('online', function() {
      if (currentIP) {
        updateConnectionStatus('‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
        checkServerStatus();
      }
    });
    
    window.addEventListener('offline', function() {
      updateConnectionStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‚ùå');
    });
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ touch events ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
    document.addEventListener('touchstart', function() {}, {passive: true});
    
    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ zoom ‡πÄ‡∏°‡∏∑‡πà‡∏≠ double tap ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°
    document.querySelectorAll('.button').forEach(button => {
      button.addEventListener('touchend', function(e) {
        e.preventDefault();
      });
    });
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Enter key ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á IP input
    document.getElementById('ip-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        setIPAddress();
      }
    });
  </script>
</body>
</html>